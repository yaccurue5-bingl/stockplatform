name: Stock Data Crawler

on:
  schedule:
    - cron: '*/15 * * * *' # 15분마다 자동 실행
  workflow_dispatch:      # 수동 실행 버튼 활성화

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip' # 이 한 줄이 설치 속도를 엄청나게 올립니다!
    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        # 1. requirements.txt에 선언된 라이브러리 설치
        pip install -r stock-platform-server/requirements.txt
        # 2. 누락 방지를 위해 최신 SDK 및 핵심 라이브러리 명시적 설치
        pip install google-genai supabase opendartreader

    - name: Run AI Crawler
      env:
        DART_API_KEY: ${{ secrets.DART_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      # 폴더 위치를 정확히 지정해서 실행
      run: python stock-platform-server/crawler.py