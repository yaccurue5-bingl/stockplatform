name: Stock Data Crawler

on:
  schedule:
    - cron: '*/15 * * * *' # 15분마다 자동 실행
  workflow_dispatch:      # 수동 실행 버튼 활성화

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Python Dependencies
      run: |
        pip install -r stock-platform-server/requirements.txt
        # 혹시 몰라 필요한 라이브러리 추가 설치
        pip install requests beautifulsoup4 supabase python-dotenv opendartreader google-generativeai

    - name: Run AI Crawler
      env:
        DART_API_KEY: ${{ secrets.DART_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      # 폴더 위치를 정확히 지정해서 실행
      run: python stock-platform-server/crawler.py