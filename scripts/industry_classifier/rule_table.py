"""
KSIC â†’ ìƒìœ„ ì—…ì¢… ë§¤í•‘ ë£° í…Œì´ë¸”
================================

KSIC ì¤‘ë¶„ë¥˜(2ìë¦¬)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ k-marketinsight ì„œë¹„ìŠ¤ì˜ ìƒìœ„ ì—…ì¢…ì„ ì •ì˜í•©ë‹ˆë‹¤.

ì™œ KSIC ì¤‘ë¶„ë¥˜ë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?
- ëŒ€ë¶„ë¥˜(1ìë¦¬): ë„ˆë¬´ ê´‘ë²”ìœ„í•¨ (ì˜ˆ: C=ì œì¡°ì—… ì „ì²´)
- ì†Œë¶„ë¥˜(3ìë¦¬): ë„ˆë¬´ ì„¸ë¶„í™”ë˜ì–´ ì„œë¹„ìŠ¤ ìš´ì˜ì´ ë³µì¡í•¨
- ì¤‘ë¶„ë¥˜(2ìë¦¬): íˆ¬ììê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ ì ì ˆí•œ ìˆ˜ì¤€ì˜ ì—…ì¢… êµ¬ë¶„

ì˜ˆì‹œ:
- KSIC 26 = ì „ìë¶€í’ˆ, ì»´í“¨í„°, ì˜ìƒ, ìŒí–¥ ë° í†µì‹ ì¥ë¹„ ì œì¡°ì—…
  â†’ ì„œë¹„ìŠ¤ ì—…ì¢…: "ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„"
- KSIC 21 = ì˜ë£Œìš© ë¬¼ì§ˆ ë° ì˜ì•½í’ˆ ì œì¡°ì—…
  â†’ ì„œë¹„ìŠ¤ ì—…ì¢…: "ë°”ì´ì˜¤Â·ì œì•½"
"""

# KSIC ì¤‘ë¶„ë¥˜ â†’ ìƒìœ„ ì—…ì¢… ë§¤í•‘
# í‚¤: KSIC ì¤‘ë¶„ë¥˜ ì½”ë“œ(2ìë¦¬ ë¬¸ìì—´)
# ê°’: k-marketinsight ì„œë¹„ìŠ¤ì˜ ìƒìœ„ ì—…ì¢…ëª…
KSIC_TOP_INDUSTRY_RULES = {
    # ì œì¡°ì—… - ì „ì/ë°˜ë„ì²´
    "26": "ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„",
    "27": "ë””ìŠ¤í”Œë ˆì´Â·ì „ìë¶€í’ˆ",
    "28": "ì „ê¸°ì¥ë¹„",

    # ì œì¡°ì—… - í™”í•™/ì†Œì¬
    "20": "í™”í•™",
    "21": "ë°”ì´ì˜¤Â·ì œì•½",
    "22": "ê³ ë¬´Â·í”Œë¼ìŠ¤í‹±",
    "23": "ë¹„ê¸ˆì†ê´‘ë¬¼",
    "24": "2ì°¨ì „ì§€Â·ì†Œì¬",
    "25": "ê¸ˆì†ê°€ê³µ",

    # ì œì¡°ì—… - ê¸°ê³„/ìš´ì†¡
    "29": "ìë™ì°¨",
    "30": "ë°©ì‚°Â·í•­ê³µ",
    "31": "ê¸°ê³„Â·ì„¤ë¹„",

    # ì œì¡°ì—… - ìƒí™œì†Œë¹„ì¬
    "10": "ì‹í’ˆ",
    "11": "ìŒë£Œ",
    "12": "ë‹´ë°°",
    "13": "ì„¬ìœ ",
    "14": "ì˜ë³µÂ·íŒ¨ì…˜",
    "15": "ê°€ì£½Â·ì‹ ë°œ",
    "16": "ëª©ì¬Â·ì¢…ì´",
    "17": "ì¶œíŒÂ·ì¸ì‡„",
    "18": "ì„ìœ Â·í™”í•™ì œí’ˆ",
    "19": "1ì°¨ê¸ˆì†",

    # ITÂ·ì„œë¹„ìŠ¤
    "58": "ì¶œíŒÂ·ë¯¸ë””ì–´",
    "59": "ì˜ìƒÂ·ë°©ì†¡",
    "60": "í†µì‹ Â·ë°©ì†¡",
    "61": "í†µì‹ ",
    "62": "ITÂ·ì†Œí”„íŠ¸ì›¨ì–´",
    "63": "ì •ë³´ì„œë¹„ìŠ¤",

    # ê¸ˆìœµ
    "64": "ê¸ˆìœµ",
    "65": "ë³´í—˜Â·ì—°ê¸ˆ",
    "66": "ê¸ˆìœµì§€ì›ì„œë¹„ìŠ¤",

    # ìœ í†µÂ·ì„œë¹„ìŠ¤
    "45": "ê±´ì„¤",
    "46": "ë„ë§¤",
    "47": "ì†Œë§¤",
    "49": "ìš´ì†¡",
    "50": "ì°½ê³ Â·ë¬¼ë¥˜",
    "51": "í•­ê³µ",
    "52": "ì°½ê³ Â·ìš´ì†¡",
    "55": "ìˆ™ë°•",
    "56": "ìŒì‹ì ",

    # ì „ë¬¸ì„œë¹„ìŠ¤
    "70": "ë¶€ë™ì‚°",
    "71": "ì „ë¬¸Â·ê³¼í•™Â·ê¸°ìˆ ì„œë¹„ìŠ¤",
    "72": "ì—°êµ¬ê°œë°œ",
    "73": "ê´‘ê³ Â·ì‹œì¥ì¡°ì‚¬",
    "74": "ì „ë¬¸ì„œë¹„ìŠ¤",
    "75": "ì‚¬ì—…ì§€ì›ì„œë¹„ìŠ¤",

    # ê³µê³µÂ·êµìœ¡Â·ì˜ë£Œ
    "84": "ê³µê³µí–‰ì •",
    "85": "êµìœ¡",
    "86": "ë³´ê±´Â·ì˜ë£Œ",
    "87": "ì‚¬íšŒë³µì§€",
    "88": "ì˜ˆìˆ Â·ìŠ¤í¬ì¸ Â·ì—¬ê°€",
    "90": "ì°½ì‘Â·ì˜ˆìˆ ",
    "91": "ë„ì„œê´€Â·ë°•ë¬¼ê´€",

    # ê¸°íƒ€
    "01": "ë†ì—…",
    "02": "ì„ì—…",
    "03": "ì–´ì—…",
    "05": "ì„íƒ„Â·ê´‘ì—…",
    "06": "ì›ìœ Â·ê°€ìŠ¤",
    "07": "ê¸ˆì†ê´‘ì—…",
    "08": "ë¹„ê¸ˆì†ê´‘ë¬¼",
    "35": "ì „ê¸°Â·ê°€ìŠ¤",
    "36": "ìˆ˜ë„",
    "37": "í•˜ìˆ˜Â·íê¸°ë¬¼",
    "38": "í™˜ê²½Â·ë³µì›",
    "39": "í™˜ê²½ì •í™”",
    "41": "ê±´ì„¤",
    "42": "í† ëª©",
    "43": "ì „ë¬¸ê±´ì„¤",
}


def get_top_industry(ksic_code: str) -> str:
    """
    KSIC ì½”ë“œë¡œë¶€í„° ìƒìœ„ ì—…ì¢…ì„ ì¡°íšŒ

    Args:
        ksic_code: KSIC ì‚°ì—…ë¶„ë¥˜ì½”ë“œ (ì˜ˆ: "26110", "C26110")

    Returns:
        ìƒìœ„ ì—…ì¢…ëª… (ì˜ˆ: "ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„")
        ë§¤í•‘ì´ ì—†ì„ ê²½ìš° "ê¸°íƒ€"

    Examples:
        >>> get_top_industry("26110")
        'ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„'
        >>> get_top_industry("C2611")
        'ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„'
        >>> get_top_industry("21")
        'ë°”ì´ì˜¤Â·ì œì•½'
    """
    if not ksic_code:
        return "ë¯¸ë¶„ë¥˜"

    # KSIC ì½”ë“œì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œ
    numeric_code = ''.join(filter(str.isdigit, str(ksic_code)))

    if len(numeric_code) < 2:
        return "ë¯¸ë¶„ë¥˜"

    # ì¤‘ë¶„ë¥˜(ì• 2ìë¦¬) ì¶”ì¶œ
    middle_class = numeric_code[:2]

    # ë£° í…Œì´ë¸”ì—ì„œ ì¡°íšŒ
    return KSIC_TOP_INDUSTRY_RULES.get(middle_class, "ê¸°íƒ€")


def get_all_top_industries() -> list[str]:
    """
    ëª¨ë“  ìƒìœ„ ì—…ì¢… ëª©ë¡ ë°˜í™˜ (ì¤‘ë³µ ì œê±°)

    Returns:
        ìƒìœ„ ì—…ì¢…ëª… ë¦¬ìŠ¤íŠ¸ (ì•ŒíŒŒë²³ ìˆœ)
    """
    return sorted(set(KSIC_TOP_INDUSTRY_RULES.values()))


def get_ksic_codes_by_industry(industry: str) -> list[str]:
    """
    ìƒìœ„ ì—…ì¢…ì— í•´ë‹¹í•˜ëŠ” KSIC ì¤‘ë¶„ë¥˜ ì½”ë“œ ëª©ë¡ ë°˜í™˜

    Args:
        industry: ìƒìœ„ ì—…ì¢…ëª… (ì˜ˆ: "ë°˜ë„ì²´ì™€ ë°˜ë„ì²´ì¥ë¹„")

    Returns:
        KSIC ì¤‘ë¶„ë¥˜ ì½”ë“œ ë¦¬ìŠ¤íŠ¸ (ì˜ˆ: ["26"])
    """
    return [code for code, ind in KSIC_TOP_INDUSTRY_RULES.items() if ind == industry]


def export_rule_table(output_path: str = None):
    """
    ë£° í…Œì´ë¸”ì„ JSON íŒŒì¼ë¡œ ì €ì¥

    Args:
        output_path: ì¶œë ¥ íŒŒì¼ ê²½ë¡œ (ê¸°ë³¸ê°’: data/ksic/rule_table.json)
    """
    import json
    from pathlib import Path

    if output_path is None:
        from .config import KSIC_DATA_DIR
        output_path = KSIC_DATA_DIR / "rule_table.json"
    else:
        output_path = Path(output_path)

    output_path.parent.mkdir(parents=True, exist_ok=True)

    with open(output_path, 'w', encoding='utf-8') as f:
        json.dump(KSIC_TOP_INDUSTRY_RULES, f, ensure_ascii=False, indent=2)

    print(f"âœ“ ë£° í…Œì´ë¸” ì €ì¥ ì™„ë£Œ: {output_path}")
    return output_path


if __name__ == "__main__":
    # í…ŒìŠ¤íŠ¸ ë° í™•ì¸
    print("=" * 60)
    print("KSIC â†’ ìƒìœ„ ì—…ì¢… ë§¤í•‘ ë£° í…Œì´ë¸”")
    print("=" * 60)
    print()

    # í†µê³„
    print(f"ì´ KSIC ì¤‘ë¶„ë¥˜ ë§¤í•‘: {len(KSIC_TOP_INDUSTRY_RULES)}ê°œ")
    print(f"ì´ ìƒìœ„ ì—…ì¢…: {len(get_all_top_industries())}ê°œ")
    print()

    # ìƒìœ„ ì—…ì¢… ëª©ë¡
    print("ğŸ“Š ìƒìœ„ ì—…ì¢… ëª©ë¡:")
    for i, industry in enumerate(get_all_top_industries(), 1):
        ksic_codes = get_ksic_codes_by_industry(industry)
        print(f"  {i:2d}. {industry:20s} (KSIC: {', '.join(ksic_codes)})")
    print()

    # í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
    print("ğŸ§ª í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:")
    test_cases = [
        ("26110", "ì‚¼ì„±ì „ì"),
        ("21", "ì œì•½íšŒì‚¬"),
        ("64", "ì€í–‰"),
        ("C2611", "ë°˜ë„ì²´ ì œì¡°ì‚¬"),
    ]
    for ksic_code, description in test_cases:
        result = get_top_industry(ksic_code)
        print(f"  {ksic_code:10s} ({description:15s}) â†’ {result}")
    print()

    # JSON íŒŒì¼ë¡œ ì €ì¥
    export_rule_table()
