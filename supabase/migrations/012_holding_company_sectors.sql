-- =========================================
-- 주요 지주회사 업종 세분화
-- =========================================
-- 지주회사(KSIC 6420)를 주력 사업 기반으로 세분화

-- 먼저 세분화된 지주회사 업종을 sectors 테이블에 추가
INSERT INTO public.sectors (name, description) VALUES
  ('지주회사(전자·화학)', 'LG 등 전자/화학 계열 지주회사'),
  ('지주회사(반도체·ICT)', 'SK 등 반도체/ICT 계열 지주회사'),
  ('지주회사(방산·에너지)', '한화 등 방산/에너지 계열 지주회사'),
  ('지주회사(유통·식품)', '롯데, CJ 등 유통/식품 계열 지주회사'),
  ('지주회사(에너지·인프라)', 'GS, 현대중공업 등 에너지/인프라 계열 지주회사'),
  ('지주회사(자동차)', '현대차 등 자동차 계열 지주회사'),
  ('지주회사(건설·시멘트)', '삼성물산, 한일시멘트 등 건설 계열 지주회사'),
  ('지주회사(금융)', '금융 계열 지주회사'),
  ('지주회사(기타)', '기타 지주회사')
ON CONFLICT (name) DO NOTHING;

-- =========================================
-- 주요 지주회사 업종 업데이트
-- =========================================

-- 전자·화학 계열
UPDATE public.companies SET sector = '지주회사(전자·화학)'
WHERE stock_code IN (
  '003550',  -- LG
  '051910',  -- LG화학
  '051900'   -- LG생활건강 (지주 기능)
);

-- 반도체·ICT 계열
UPDATE public.companies SET sector = '지주회사(반도체·ICT)'
WHERE stock_code IN (
  '034730',  -- SK
  '017670',  -- SK텔레콤
  '034020',  -- 두산에너빌리티 지주
  '036570'   -- 엔씨소프트 (게임 대표)
);

-- 방산·에너지 계열
UPDATE public.companies SET sector = '지주회사(방산·에너지)'
WHERE stock_code IN (
  '000880',  -- 한화
  '009830',  -- 한화솔루션
  '012450'   -- 한화에어로스페이스
);

-- 유통·식품 계열
UPDATE public.companies SET sector = '지주회사(유통·식품)'
WHERE stock_code IN (
  '004990',  -- 롯데지주
  '001040',  -- CJ
  '005180',  -- 빙그레 (식품 대표)
  '097950',  -- CJ제일제당
  '051600',  -- 한전KPS
  '007310',  -- 오뚜기
  '271560',  -- 오리온
  '280360',  -- 롯데웰푸드
  '004370',  -- 농심
  '014710'   -- 사조대림
);

-- 에너지·인프라 계열
UPDATE public.companies SET sector = '지주회사(에너지·인프라)'
WHERE stock_code IN (
  '078930',  -- GS
  '267250',  -- HD현대
  '329180',  -- HD현대중공업
  '011210',  -- 현대위아
  '042660',  -- 대우조선해양 (한화오션)
  '010140',  -- 삼성중공업
  '006260',  -- LS
  '010120',  -- LS일렉트릭
  '006400',  -- 삼성SDI (에너지)
  '373220'   -- LG에너지솔루션
);

-- 자동차 계열
UPDATE public.companies SET sector = '지주회사(자동차)'
WHERE stock_code IN (
  '005380',  -- 현대차
  '000270',  -- 기아
  '012330',  -- 현대모비스
  '018880',  -- 한온시스템
  '161390',  -- 한국타이어앤테크놀로지
  '000240'   -- 한국타이어
);

-- 건설·시멘트 계열
UPDATE public.companies SET sector = '지주회사(건설·시멘트)'
WHERE stock_code IN (
  '028260',  -- 삼성물산
  '000150',  -- 두산
  '000720',  -- 현대건설
  '047040',  -- 대우건설
  '034300',  -- 신세계건설
  '006360',  -- GS건설
  '002380'   -- KCC
);

-- 금융 계열 (실제 금융 지주회사)
UPDATE public.companies SET sector = '지주회사(금융)'
WHERE stock_code IN (
  '055550',  -- 신한지주
  '086790',  -- 하나금융지주
  '105560',  -- KB금융
  '138930',  -- BNK금융지주
  '139130',  -- DGB금융지주
  '316140',  -- 우리금융지주
  '024110',  -- 기업은행
  '000810',  -- 삼성화재
  '032830',  -- 삼성생명
  '088350',  -- 한화생명
  '005830',  -- DB손해보험
  '001450'   -- 현대해상
);

-- =========================================
-- 결과 확인
-- =========================================
-- SELECT sector, COUNT(*) as cnt, array_agg(corp_name) as companies
-- FROM public.companies
-- WHERE sector LIKE '지주회사%'
-- GROUP BY sector
-- ORDER BY sector;
